# 网上书店管理系统 - 前端测试指南

## 📋 前置准备

### 1. 确保数据库已配置
- 数据库：MySQL（InnoDB）
- 数据库名：`OnlineBookStore`（根据你的 DBUtil.java 配置）
- 确保数据库中有测试数据（书籍、客户、供应商等）

### 2. 检查 DBUtil.java 配置
打开 `src/main/java/util/DBUtil.java`，确认：
```java
private static final String JDBC_URL = "jdbc:mysql://localhost:3306/OnlineBookStore?...";
private static final String JDBC_USER = "root";
private static final String JDBC_PASSWORD = "666666";  // 你的密码
```

### 3. 准备 Tomcat 服务器
- 下载 Tomcat 9.x 或 10.x（推荐 9.x，因为代码使用 `javax.servlet.*`）
- 解压到本地目录（如：`D:\apache-tomcat-9.0.xx`）

---

## 🚀 部署步骤

### 方法1：使用 IntelliJ IDEA（推荐）

#### 步骤1：配置 Tomcat
1. 打开 IntelliJ IDEA
2. 点击右上角 `Add Configuration...`（或 `Run` → `Edit Configurations...`）
3. 点击 `+` → 选择 `Tomcat Server` → `Local`
4. 配置：
   - **Name**: `Tomcat 9`
   - **Application server**: 选择你的 Tomcat 安装目录
   - **HTTP port**: `8080`（默认）
   - **JRE**: 选择你的 JDK（JDK 21）

#### 步骤2：配置 Artifact
1. 在 `Edit Configurations` 窗口中，切换到 `Deployment` 标签
2. 点击 `+` → `Artifact`
3. 选择 `数据库课程设计:war` 或 `数据库课程设计:war exploded`
   - **推荐使用 `war exploded`**（支持热部署）
4. **Application context**: `/` 或 `/bookstore`（访问路径）
5. 点击 `OK`

#### 步骤3：添加 servlet-api.jar 依赖
1. 从 Tomcat 的 `lib` 目录复制 `servlet-api.jar`
2. 在 IDEA 中：`File` → `Project Structure` → `Libraries` → `+` → `Java`
3. 选择 `servlet-api.jar`，点击 `OK`

#### 步骤4：运行项目
1. 点击右上角的运行按钮（绿色三角形）
2. 等待 Tomcat 启动
3. 浏览器自动打开，或手动访问：`http://localhost:8080/`

---

### 方法2：手动部署到 Tomcat

#### 步骤1：编译项目
```bash
# 在项目根目录执行
javac -encoding UTF-8 -cp "lib/*;src/main/java" -d out/production/数据库课程设计 src/main/java/**/*.java
```

#### 步骤2：打包 WAR 文件
1. 创建 `WEB-INF/classes` 目录结构
2. 复制编译后的 `.class` 文件到 `WEB-INF/classes`
3. 复制 `src/main/webapp` 下的所有文件到 WAR 根目录
4. 打包成 `bookstore.war`

#### 步骤3：部署到 Tomcat
1. 将 `bookstore.war` 复制到 Tomcat 的 `webapps` 目录
2. 启动 Tomcat（运行 `bin/startup.bat` 或 `bin/startup.sh`）
3. 访问：`http://localhost:8080/bookstore/`

---

## 🧪 测试步骤

### 1. 测试首页
访问：`http://localhost:8080/` 或 `http://localhost:8080/index.jsp`
- 检查导航栏是否正常显示
- 检查页面样式是否加载（Bootstrap CSS）

### 2. 测试书目查询
访问：`http://localhost:8080/book`
- 测试书名搜索
- 测试关键字搜索
- 测试作者搜索
- 测试出版社搜索
- 点击"查看详情"按钮
- 点击"加入购物车"按钮

### 3. 测试购物车
访问：`http://localhost:8080/order/cart`
- 检查购物车商品列表
- 测试修改数量
- 测试删除商品
- 测试清空购物车
- 点击"去结算"

### 4. 测试下单
访问：`http://localhost:8080/order/checkout`
- 检查订单确认信息
- 检查信用等级和折扣显示
- 填写收货地址
- 点击"确认下单"

### 5. 测试订单管理
访问：`http://localhost:8080/order/list`
- 检查订单列表
- 测试按状态筛选
- 点击"查看详情"
- 访问：`http://localhost:8080/order/detail?orderId=1`

### 6. 测试采购管理
访问：`http://localhost:8080/purchase/list`
- 检查采购单列表
- 点击"查看明细"
- 访问：`http://localhost:8080/purchase/detail?poId=1`
- 测试"执行到货"功能

### 7. 测试缺书记录
访问：`http://localhost:8080/purchase/shortage/list`
- 检查缺书记录列表
- 测试筛选功能

### 8. 测试客户管理
访问：`http://localhost:8080/customer/info`
- 检查客户信息显示
- 测试"充值余额"功能
- 测试"调整信用等级"功能
- 测试"调整透支额度"功能
- 访问：`http://localhost:8080/customer/orders` 查看订单历史

### 9. 测试发货管理
访问：`http://localhost:8080/shipment/list`
- 检查待发货订单项列表
- 点击"发货"按钮
- 填写发货数量、承运商、运单号
- 测试发货功能（会触发扣款）

---

## 🔍 常见问题排查

### 问题1：404 错误
- **原因**：URL 路径错误或 Servlet 未正确映射
- **解决**：检查 `web.xml` 中的 Servlet 映射配置

### 问题2：500 错误（服务器内部错误）
- **原因**：代码异常或数据库连接失败
- **解决**：
  1. 查看 Tomcat 控制台错误信息
  2. 检查 `DBUtil.java` 中的数据库连接配置
  3. 确认数据库服务已启动
  4. 确认数据库中有测试数据

### 问题3：页面样式丢失
- **原因**：Bootstrap CDN 无法访问或路径错误
- **解决**：
  1. 检查网络连接
  2. 检查 `header.jsp` 中的 Bootstrap CDN 链接
  3. 可以下载 Bootstrap 到本地使用

### 问题4：中文乱码
- **原因**：字符编码配置不正确
- **解决**：
  1. 确认 `web.xml` 中配置了 `CharacterEncodingFilter`
  2. 确认所有 JSP 页面设置了 `pageEncoding="UTF-8"`
  3. 确认数据库连接 URL 包含 `characterEncoding=utf8mb4`

### 问题5：Servlet 类找不到
- **原因**：缺少 `servlet-api.jar` 依赖
- **解决**：按照"前置准备"中的步骤添加依赖

### 问题6：数据库连接失败
- **原因**：数据库配置错误或 MySQL 服务未启动
- **解决**：
  1. 检查 MySQL 服务是否运行
  2. 检查 `DBUtil.java` 中的连接信息
  3. 确认数据库已创建
  4. 测试连接：`mysql -u root -p`

---

## 📝 测试数据准备

### 插入测试数据 SQL（示例）

```sql
-- 插入测试客户
INSERT INTO Customer (Email, PasswordHash, Name, Address, Balance, CreditLevel, MonthlyLimit) 
VALUES ('test@example.com', 'hash123', '测试用户', '测试地址', 1000.00, 3, 500.00);

-- 插入测试书籍
INSERT INTO Book (Title, Publisher, Price, StockQuantity, Catalog) 
VALUES ('数据库系统概论', '高等教育出版社', 59.00, 100, '第一章...');

-- 插入测试供应商
INSERT INTO Supplier (Name, Address, Phone, ContactEmail) 
VALUES ('测试供应商', '供应商地址', '123456789', 'supplier@example.com');

-- 插入测试订单（可选，用于测试订单管理）
-- 通过前端下单功能创建订单
```

---

## 🎯 快速测试清单

- [ ] 首页能正常访问
- [ ] 书目查询功能正常
- [ ] 书籍详情页显示正常
- [ ] 购物车功能正常
- [ ] 下单功能正常
- [ ] 订单列表显示正常
- [ ] 订单详情显示正常
- [ ] 采购单列表显示正常
- [ ] 采购到货功能正常
- [ ] 缺书记录列表显示正常
- [ ] 客户信息显示正常
- [ ] 充值余额功能正常
- [ ] 调整信用等级功能正常
- [ ] 调整透支额度功能正常
- [ ] 订单历史显示正常
- [ ] 发货列表显示正常
- [ ] 发货功能正常（扣款逻辑）

---

## 💡 调试技巧

### 1. 查看 Tomcat 日志
- 位置：`Tomcat安装目录/logs/catalina.out` 或 `localhost.log`
- 查看错误堆栈信息

### 2. 使用浏览器开发者工具
- 按 `F12` 打开开发者工具
- 查看 `Console` 标签的 JavaScript 错误
- 查看 `Network` 标签的 HTTP 请求/响应

### 3. 添加调试输出
在 Servlet 中添加：
```java
System.out.println("调试信息：" + variable);
```

### 4. 检查 Session
在 JSP 中添加：
```jsp
<%
    System.out.println("Session ID: " + session.getId());
    System.out.println("Customer ID: " + session.getAttribute("customerId"));
%>
```

---

## 🚨 重要提示

1. **默认客户ID**：当前代码中多处使用默认客户ID `1`，实际应从登录信息获取
2. **Session 管理**：当前未实现登录功能，客户ID暂时写死
3. **错误处理**：所有异常都会打印到控制台，注意查看
4. **数据库事务**：确保数据库支持事务（InnoDB）

---

## 📞 需要帮助？

如果遇到问题：
1. 查看 Tomcat 控制台错误信息
2. 查看浏览器控制台错误信息
3. 检查数据库连接和测试数据
4. 确认所有依赖已正确配置

